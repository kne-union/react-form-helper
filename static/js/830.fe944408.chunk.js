"use strict";(self.webpackChunk_kne_components_react_form_helper=self.webpackChunk_kne_components_react_form_helper||[]).push([[830],{71830:(e,t,r)=>{r.r(t),r.d(t,{default:()=>z,hoc:()=>T,hooks:()=>j,preset:()=>L,utils:()=>q,widget:()=>W});var n=r(94922),a=r.n(n),l=r(89102),s=r(54159),o=r.n(s),i=r(57790),u=r(94530),c=r(64755),d=r.n(c),m=r(32662);function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f.apply(null,arguments)}function p(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;r[n]=e[n]}return r}const g=["triggerValidate","onBlur"],h=e=>{let{triggerValidate:t,onBlur:r}=e,a=p(e,g);return f({onBlur:(0,n.useCallback)((function(){r&&r(...arguments),t()}),[r,t])},a)},v=["triggerValidate","value","onChange"],b=e=>{let{triggerValidate:t,value:r,onChange:a}=e,l=p(e,v);const s=(0,n.useRef)(!1),o=(0,n.useRef)(t),i=(0,n.useCallback)((function(){a&&a(...arguments),s.current=!0}),[a]);return o.current=t,(0,n.useEffect)((()=>{s.current&&o.current()}),[r]),f({value:r,onChange:i},l)},C=["checked"],_=["value"],E=(0,n.createContext)({}),{Provider:x}=E,k=(0,n.createContext)({size:"middle"}),{Provider:y,Consumer:S}=k,w=(0,n.createContext)({}),{Provider:O}=w,N=e=>{let{props:t,children:r}=e;return a().createElement(O,{value:t},r)},R=["id","name","rule","description","className","onChange","label","labelRender","labelTips","labelHidden","errMsg","errState","isValueChanged","wrappedClassName","fieldRef","important","ignoreLabelWidth","formState","groupIndex","groupName","formData","associationOptions"],F=e=>{const{name:t,rule:r,description:s,className:i,onChange:u,label:c,labelRender:d,labelTips:m,labelHidden:g,errMsg:h,errState:v,isValueChanged:b,wrappedClassName:C,fieldRef:_,important:x,ignoreLabelWidth:y,associationOptions:S}=e,w=p(e,R),O=(()=>{const{size:e}=(0,n.useContext)(k);return e})(),[F,V]=(0,n.useState)(!1),[L,P]=(0,n.useState)(!1),{emitter:A}=(0,l.useFormContext)(),I=(()=>{const{maxWidth:e}=(0,n.useContext)(E);return e})();(0,n.useEffect)((()=>{"string"===typeof r&&V((r||"").split(" ").indexOf("REQ")>-1)}),[V,t,r]),(0,n.useEffect)((()=>{const e=A.addListener("form:submit",(()=>{P(!0)}));return()=>{e&&e.remove()}}),[A]);const M=(0,n.useCallback)((function(){u(...arguments),P(!1)}),[u,P]);return(0,n.useCallback)((t=>{const r={};!y&&I>0&&(r.minWidth=I);const n=(e=>{let{errMsg:t,errState:r,isSubmit:n,isValueChanged:a}=e;return{"is-req-error":""===t&&2===r&&(n||a),"is-error":""!==t&&2===r,"is-loading":3===r}})({errMsg:h,errState:v,isSubmit:L,isValueChanged:b}),l=void 0!==x?x:F;return O&&(w.size=O),a().createElement("div",{ref:_,className:o()("react-form__field",{"is-ignore-label-width":y},C,n)},a().createElement("div",{className:"react-form__field-main"},c&&!g?a().createElement("div",{className:o()("react-form__field-label",{"is-req":l}),style:r},a().createElement("i",{className:"react-form__field_extra"}),"function"===typeof d?d(f({label:c},w)):c,m&&a().createElement("span",{className:"react-form__field_label-tips"},"function"===typeof m?m(e):m)):null,a().createElement("div",{className:"react-form__field-input"},a().createElement(N,{props:e},a().createElement(t,f({},Object.assign({},w,S),{className:o()("react-form__field-component",i),onChange:M})),s?a().createElement("div",{className:"react-form__field-describable"},s):null,h?a().createElement("div",{className:"react-form__field-error"},h):null))))}),[I,_,g,y,w,S,b,i,h,v,M,x,F,L,c,C])},V={field:{}};var L=e=>{d()(V,e)};const P=["fieldName"],A=["realtime"],I=e=>{let{fieldName:t}=e,r=p(e,P);return Object.assign({},V.globalProps,V.field[t],r)},M=["type","children"],j={useField:l.useField,useFieldProps:()=>(0,n.useContext)(w),useBlurDecorator:h,useChangeDecorator:b,useCheckedToValue:e=>{let{checked:t}=e;return f({},p(e,C),{value:t})},useDecorator:e=>{let{realtime:t}=e,r=p(e,A);const n=(0,l.useField)(I(Object.assign(t?{debounce:500}:{},r))),a=b(n),s=h(n),o=Object.assign({},s,a);return F(t?o:s)},useOnBlur:e=>{const t=(0,l.useField)(I(e)),r=h(t);return F(r)},useOnChange:e=>{const t=(0,l.useField)(I(e)),r=b(t);return F(r)},useUIDecorator:F,useCacheRemove:()=>{const{emitter:e}=(0,l.useFormContext)();return()=>{e.emit("form-widget:store:remove")}}},T={withChecked:e=>t=>{let{value:r}=t,n=p(t,_);return a().createElement(e,f({},n,{checked:r}))}},W={ScrollToError:e=>{let{scrollProps:t={}}=e;const{emitter:r}=(0,l.useFormContext)();return(0,n.useEffect)((()=>{const e=r.addListener("form:submit:error",(e=>{const r=(0,u.get)(e,"[0].fieldRef.current");r&&"function"===typeof r.scrollIntoView&&r.scrollIntoView(t)}));return()=>{e&&e.remove()}}),[r]),null},EnterSubmit:e=>{let{type:t="div",children:r}=e,s=p(e,M);const{emitter:o}=(0,l.useFormContext)(),i=(0,n.useCallback)((e=>{13===e.keyCode&&o.emit("form:submit")}),[o]);return a().createElement(t,Object.assign({},s,{onKeyUp:i}),r)},MaxLabelProvider:e=>{let{minLabelWidth:t,children:r}=e;const[s,o]=(0,n.useState)(t||0),{fields:c}=(0,l.useFormContext)(),d=(0,n.useRef)(null);return(0,n.useLayoutEffect)((()=>{const e=d.current.querySelector(".react-form__field-label")||d.current,t=window.getComputedStyle(e).getPropertyValue("font-size");o(Math.max(...(0,u.uniq)([].map.call(d.current.querySelectorAll(".react-form__field-label"),(e=>e.innerText))).map((e=>(0,i.A)(e,t)))))}),[c]),a().createElement(x,{value:{maxWidth:s,setMaxWidth:o}},a().createElement("span",{ref:d},r))},FormStore:e=>{let{cache:t}=e;const r=(0,n.useRef)(`REACT_FORM_STORE_${t}`),a=(0,n.useRef)(new Map),{emitter:s,openApi:o}=(0,l.useFormContext)();return(0,n.useEffect)((()=>{const e=m.A.getItem(r.current)||{},t=s.addListener("form:field:ready",(t=>{e[t.path]&&s.emit(`form-field:input:${t.id}`,{value:e[t.path].value})})),n=s.addListener("form:field:set-value",(e=>{let{id:t,value:n,path:l}=e;if(void 0===n)return;a.current.set(t,{id:t,value:n,path:l});const s=Object.assign({},m.A.getItem(r.current));s[l]={id:t,value:n,path:l},m.A.setItem(r.current,s)})),l=s.addListener("form:submit:success",(()=>{m.A.removeItem(r.current)})),o=s.addListener("form-widget:store:remove",(()=>{m.A.removeItem(r.current)}));return()=>{t&&t.remove(),n&&n.remove(),l&&l.remove(),o&&o.remove()}}),[s]),null},SizeProvider:y},q={},z={hooks:j,hoc:T,widget:W,utils:q}}}]);
//# sourceMappingURL=830.fe944408.chunk.js.map